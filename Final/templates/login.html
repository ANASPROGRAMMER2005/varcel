{% extends "base.html" %}

{% block title %}Login - CampusLink{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <i class="fas fa-graduation-cap"></i>
            <h2>Welcome Back</h2>
            <p>Sign in to your CampusLink account</p>
        </div>

        <div class="auth-tabs">
            <button class="tab-btn active" onclick="switchTab('login')">Login</button>
            <button class="tab-btn" onclick="switchTab('signup')">Sign Up</button>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="auth-form active">
            <div class="form-group">
                <label for="loginRole">Login As</label>
                <div class="role-selection">
                    <label class="role-option">
                        <input type="radio" name="role" value="student" checked>
                        <div class="role-card">
                            <i class="fas fa-user-graduate"></i>
                            <span>Student</span>
                            <p>Access all campus services and features</p>
                        </div>
                    </label>
                    <label class="role-option">
                        <input type="radio" name="role" value="admin">
                        <div class="role-card">
                            <i class="fas fa-user-shield"></i>
                            <span>Admin</span>
                            <p>Manage campus services and content</p>
                        </div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="loginEmail">Email Address</label>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="loginEmail" name="email" placeholder="Enter your email" required>
                </div>
            </div>

            <div class="form-group">
                <label for="loginPassword">Password</label>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="loginPassword" name="password" placeholder="Enter your password" required>
                    <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="form-options">
                <label class="checkbox-container">
                    <input type="checkbox" name="remember">
                    <span class="checkmark"></span>
                    Remember me
                </label>
                <a href="#" class="forgot-password">Forgot Password?</a>
            </div>

            <button type="submit" class="btn btn-primary btn-full">
                <i class="fas fa-sign-in-alt"></i> Sign In
            </button>

            <div class="auth-divider">
                <span>or continue with</span>
            </div>

            <div class="social-login">
                <button type="button" class="btn btn-social google" onclick="signInWithGoogle()">
                    <i class="fab fa-google"></i> Google
                </button>
                <button type="button" class="btn btn-social microsoft" onclick="signInWithMicrosoft()">
                    <i class="fab fa-microsoft"></i> Microsoft
                </button>
            </div>
        </form>

        <!-- Signup Form -->
        <form id="signupForm" class="auth-form">
            <div class="form-group">
                <label for="signupRole">Register As</label>
                <div class="role-selection">
                    <label class="role-option">
                        <input type="radio" name="role" value="student" checked onchange="toggleSignupFields()">
                        <div class="role-card">
                            <i class="fas fa-user-graduate"></i>
                            <span>Student</span>
                            <p>Join the campus community</p>
                        </div>
                    </label>
                    <label class="role-option">
                        <input type="radio" name="role" value="admin" onchange="toggleSignupFields()">
                        <div class="role-card">
                            <i class="fas fa-user-shield"></i>
                            <span>Admin</span>
                            <p>Manage campus services</p>
                        </div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="signupName">Full Name</label>
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="signupName" name="name" placeholder="Enter your full name" required>
                </div>
            </div>

            <div class="form-group">
                <label for="signupEmail">Email Address</label>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="signupEmail" name="email" placeholder="Enter your email" required>
                </div>
            </div>

            <div class="form-group" id="studentIdGroup">
                <label for="studentId">Student ID</label>
                <div class="input-group">
                    <i class="fas fa-id-card"></i>
                    <input type="text" id="studentId" name="student_id" placeholder="Enter your student ID">
                </div>
            </div>

            <div class="form-group" id="adminCodeGroup" style="display: none;">
                <label for="adminCode">Admin Access Code</label>
                <div class="input-group">
                    <i class="fas fa-key"></i>
                    <input type="text" id="adminCode" name="admin_code" placeholder="Enter admin access code">
                </div>
            </div>

            <div class="form-group">
                <label for="signupPassword">Password</label>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="signupPassword" name="password" placeholder="Create a password" required>
                    <button type="button" class="password-toggle" onclick="togglePassword('signupPassword')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="confirmPassword" name="confirm_password" placeholder="Confirm your password" required>
                    <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="userRole">Role</label>
                <div class="input-group">
                    <i class="fas fa-users"></i>
                    <select id="userRole" name="role" required>
                        <option value="">Select your role</option>
                        <option value="student">Student</option>
                        <option value="admin">Administrator</option>
                    </select>
                </div>
            </div>

            <div class="form-options">
                <label class="checkbox-container">
                    <input type="checkbox" name="terms" required>
                    <span class="checkmark"></span>
                    I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
                </label>
            </div>

            <button type="submit" class="btn btn-primary btn-full">
                <i class="fas fa-user-plus"></i> Create Account
            </button>
        </form>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Authenticating...</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Tab switching
function switchTab(tab) {
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const tabBtns = document.querySelectorAll('.tab-btn');

    tabBtns.forEach(btn => btn.classList.remove('active'));
    
    if (tab === 'login') {
        loginForm.classList.add('active');
        signupForm.classList.remove('active');
        document.querySelector('.tab-btn:first-child').classList.add('active');
    } else {
        signupForm.classList.add('active');
        loginForm.classList.remove('active');
        document.querySelector('.tab-btn:last-child').classList.add('active');
    }
}

// Toggle signup fields based on role
function toggleSignupFields() {
    const role = document.querySelector('input[name="role"]:checked').value;
    const studentIdGroup = document.getElementById('studentIdGroup');
    const adminCodeGroup = document.getElementById('adminCodeGroup');
    const studentIdInput = document.getElementById('studentId');
    const adminCodeInput = document.getElementById('adminCode');
    
    if (role === 'student') {
        studentIdGroup.style.display = 'block';
        adminCodeGroup.style.display = 'none';
        studentIdInput.required = true;
        adminCodeInput.required = false;
    } else {
        studentIdGroup.style.display = 'none';
        adminCodeGroup.style.display = 'block';
        studentIdInput.required = false;
        adminCodeInput.required = true;
    }
}

// Password toggle
function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const icon = input.parentElement.querySelector('.password-toggle i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Form submissions
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    showLoading();
    
    try {
        // Simulate authentication
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Determine user name based on role
        const userName = data.role === 'admin' ? 'Admin User' : 'Student User';
        
        // Store user session (in real app, use Firebase Auth)
        localStorage.setItem('user', JSON.stringify({
            email: data.email,
            role: data.role,
            name: userName,
            loginTime: new Date().toISOString()
        }));
        
        hideLoading();
        showNotification(`Welcome ${data.role}! Login successful!`, 'success');
        
        setTimeout(() => {
            window.location.href = '/dashboard';
        }, 1000);
        
    } catch (error) {
        hideLoading();
        showNotification('Login failed. Please try again.', 'error');
    }
});

document.getElementById('signupForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    // Validate passwords match
    if (data.password !== data.confirm_password) {
        showNotification('Passwords do not match!', 'error');
        return;
    }
    
    // Validate admin code if admin role
    if (data.role === 'admin' && data.admin_code !== 'ADMIN2024') {
        showNotification('Invalid admin access code!', 'error');
        return;
    }
    
    showLoading();
    
    try {
        // Simulate registration
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        hideLoading();
        showNotification(`${data.role === 'admin' ? 'Admin' : 'Student'} account created successfully!`, 'success');
        
        setTimeout(() => {
            switchTab('login');
        }, 1000);
        
    } catch (error) {
        hideLoading();
        showNotification('Registration failed. Please try again.', 'error');
    }
});

// Social login functions
function signInWithGoogle() {
    showNotification('Google Sign-In will be implemented with Firebase Auth', 'info');
}

function signInWithMicrosoft() {
    showNotification('Microsoft Sign-In will be implemented with Firebase Auth', 'info');
}

// Loading overlay
function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}

// Notification system



</script>
{% endblock %}